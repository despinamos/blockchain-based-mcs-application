<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />

    <!-- import Web3.js -->
		<script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
  </head>
<body>
  <h1>
    HomePage
  </h1>

  <!-- placeholders -->
  <div id="provider"></div>
  <div id="chainId"></div>
  <div id="latestBlock"></div>
  <div id="connectedAccount"></div>
  <div id="warn" style="color: red"></div>

    <div>
      <button id="requestAccounts">Connect to Metamask</button>
    </div>

  <script type="module">

      if(window.ethereum) {
      // use the injected Ethereum provider to initialize Web3.js
      const web3 = new Web3(window.ethereum);

      // check if Ethereum provider comes from MetaMask
      if (window.ethereum.isMetaMask) {
        document.getElementById('provider').innerText =
          'Connected to Ethereum with MetaMask.';
      } else {
        document.getElementById('provider').innerText =
          'Non-MetaMask Ethereum provider detected.';
      }

      // click event for "Request MetaMask Accounts" button
				document.getElementById('requestAccounts').addEventListener('click', async () => {
					// request accounts from MetaMask
					await window.ethereum.request({ method: 'eth_requestAccounts' });
					document.getElementById('requestAccounts').remove();

					// get list of accounts
					const accounts = await web3.eth.getAccounts();
					// get the first account and populate placeholder
					document.getElementById(
						'connectedAccount',
					).innerText = `Account: ${accounts[0]}`;

					// enable signing input
					const messageToSign = document.getElementById('messageToSign');
					const sign = document.getElementById('signMessage');
					messageToSign.disabled = false;
					sign.disabled = false;
					});

			} else {
				// no Ethereum provider - instruct user to install MetaMask
				document.getElementById('warn').innerHTML =
					"Please <a href='https://metamask.io/download/'>install MetaMask</a>.";
				document.getElementById('requestAccounts').disabled = true;
			}

  </script>

  <!-- <h2>Account: <span class="showAccount"></span></h2>
  <h2>Chain ID: <span class="showChainId"></span></h2> -->
  <!-- <script src="../../express/routes/index.js"></script> -->


  <button onclick="getLocation()">Button</button>
  <script>
      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(printLocation);
        } else {
          console.log("Geolocation is not supported by this browser.");
        }
      }

      function printLocation(position) {
        console.log("Latitude: " + position.coords.latitude +
          "\nLongitude: " + position.coords.longitude);

        // get More information using the Geoapify key
        decode_latlong(position.coords.latitude, position.coords.longitude)
      }

      async function decode_latlong(lat, long) {
        // Replace YOUR_API_KEY with the api key you got from Geoapify
        const apiUrl = `https://api.geoapify.com/v1/geocode/reverse?lat=${lat}&lon=${long}&apiKey=${"4e8a03f4dcc24306a83086b605c64112"}`;

        fetch(apiUrl)
          .then(response => response.json())
          .then(data => {
            // Extract the city name from the response
            const cityName = data.features[0].properties.city;
            console.log(`The city is: ${cityName}`);
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }
    </script>


</body>
</html>
